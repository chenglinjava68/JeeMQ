<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.stripcode.mybatis.user.dao.RscSysPositionMapper" >
  <resultMap id="TreeMap" type="com.stripcode.mybatis.common.Tree">
    <id column="parentid" property="id" jdbcType="VARCHAR" />
    <result column="parentname" property="text" jdbcType="VARCHAR" />
    <collection property="children" ofType="com.stripcode.mybatis.common.Tree">
      <id column="Position_ID" property="id" jdbcType="VARCHAR" />
      <result column="Cn_Name" property="text" jdbcType="VARCHAR" />
    </collection>
  </resultMap>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String" >
    DELETE FROM T_SYS_POSITION
    WHERE POSITION_ID = #{positionid}
  </delete>
  <insert id="insert" parameterType="RscSysPosition" >
    INSERT INTO T_SYS_POSITION (
      POSITION_ID,
      USER_ID,
      CN_NAME,
      COMMENTS,
      JOIN_ID,
      STATUS,
      DEL_FLAG,
      CREATOR,
      CREATE_TIME,
      UPDATER,
      UPDATE_TIME
    )
    VALUES
    (
      #{positionid},
      #{userid},
      #{cnname},
      #{comments},
      #{joinid},
      #{status},
      #{delFlag},
      #{creator},
      #{createTime},
      #{updater},
       #{updateTime}
    )
  </insert>
  <update id="updateByPrimaryKey" parameterType="RscSysPosition" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    UPDATE T_SYS_POSITION
    SET
      USER_ID = #{userid},
      CN_NAME = #{cnname},
      COMMENTS = #{comments},
      JOIN_ID = #{joinid},
      Status = #{status},
      UPDATER = #{updater},
      UPDATE_TIME=sysdate()
    WHERE POSITION_ID = #{positionid}
  </update>
  <select id="selectByPrimaryKey" resultType="RscSysPosition" parameterType="java.lang.String" >
    SELECT
      POSITION_ID,
      USER_ID,
      CN_NAME,
      COMMENTS,
      JOIN_ID,
      STATUS
    FROM T_SYS_POSITION
    WHERE POSITION_ID = #{positionid}
  </select>
  <select id="selectUserIdKey" resultType="RscSysPosition" parameterType="java.lang.String" >
    SELECT
    POSITION_ID,
    USER_ID,
    CN_NAME,
    COMMENTS,
    JOIN_ID,
    STATUS
    FROM T_SYS_POSITION
    WHERE USER_ID = #{userId}
  </select>
  <select id="selectAll" resultType="RscSysPosition" >
    SELECT
      POSITION_ID,
      USER_ID,
      CN_NAME,
      COMMENTS,
      JOIN_ID,
      STATUS
    FROM T_SYS_POSITION

  </select>
  <select id="selectForExport" resultType="RscSysPosition" >
    SELECT
      P.POSITION_ID,
      P.CN_NAME,
      P.COMMENTS,
      U.USER_NAME,
      M.MACRO_NAME STATUSNAME
    FROM
    T_SYS_POSITION P
    LEFT JOIN T_SYS_USER U ON P.USER_ID = U.USER_ID
    LEFT JOIN T_CODE_MACRO_DEFINE M ON M.MACRO_CODE = P.STATUS AND MACRO_TYPE = 'STATUS'
    ORDER BY P.UPDATE_TIME DESC
  </select>
  <select id="query" parameterType="map" resultType="RscSysPosition" >
    SELECT
      POSITION_ID,
      USER_ID,
      CN_NAME,
      COMMENTS,
      JOIN_ID,
      STATUS
    FROM T_SYS_POSITION
    <where>
      <if test="userId != null">
        and USER_ID = #{userId}
      </if>
      <if test="cnName != null">
        and CN_NAME = #{cnName}
      </if>
      <if test="comments != null">
        and COMMENTS = #{comments}
      </if>
      <if test="joinId != null">
        and JOIN_ID = #{joinId}
      </if>
      <if test="status != null">
        and STATUS = #{status}
      </if>
    </where>
  </select>
  <select id="queryForPage" resultType="RscSysPosition">
    SELECT
        P.POSITION_ID,
        P.CN_NAME,
        P.COMMENTS,
        U.USER_NAME,
        M.MACRO_NAME STATUSNAME
    FROM
        T_SYS_POSITION P
    LEFT JOIN T_SYS_USER U ON P.USER_ID = U.USER_ID
    LEFT JOIN T_CODE_MACRO_DEFINE M ON M.MACRO_CODE = P.STATUS
    AND MACRO_TYPE = 'STATUS'
    <where>
      <if test="userId != null">
        and p.USER_ID = #{userId}
      </if>
      <if test="cnName != null">
        and p.CN_NAME = #{cnName}
      </if>
      <if test="comments != null">
        and p.COMMENTS = #{comments}
      </if>
      <if test="joinId != null">
        and p.JOIN_ID = #{joinId}
      </if>
      <if test="status != null">
        and p.STATUS = #{status}
      </if>
    </where>
    ORDER BY P.UPDATE_TIME DESC
</select>
  <select id="selectForTree" resultType="TreeModel" parameterType="java.lang.String">
    SELECT
        A.POSITION_ID rowId,
        A.CN_NAME tagName,
        IFNULL(B.POSITION_ID,'ROOT') AS parentId
    FROM
        T_SYS_POSITION A
    LEFT JOIN T_SYS_POSITION B ON A.JOIN_ID = B.POSITION_ID AND B.DEL_FLAG = 'M0015'
    WHERE A.STATUS = 'M0043'
      AND A.DEL_FLAG = 'M0015'
      <if test="positionId !=null and positionId != '' ">
        AND A.POSITION_ID  &lt;&gt;  #{positionId}
      </if>
      ORDER BY
      A.POSITION_ID
  </select>
</mapper>